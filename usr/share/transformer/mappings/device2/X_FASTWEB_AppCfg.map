local Device_X_FASTWEB_AppCfg_ = {
  objectType = {
    name = "Device.X_FASTWEB_AppCfg.",
    access = "readOnly",
    minEntries = 1,
    maxEntries = 1,
    parameters = {
      IADFunction = {
        access = "readWrite",
        type = "boolean"
      },
    }
  }
}

----------------------------------------------------------
-- Local definitions
-- -------------------------------------------------------
local register, mapper, commitapply = register, mapper, commitapply
local uci_helper = mapper("ucihelper")
local binding={config="system", sectionname="config", option="iad_function"}
local mmpbxBinding={config="mmpbx", sectionname="global", option="enabled"}

----------------------------------------------------------
-- Mapper implementation
----------------------------------------------------------

Device_X_FASTWEB_AppCfg_.get = {
  IADFunction = function(mapping)
    binding.default = "0"
    return uci_helper.get_from_uci(binding)
  end,
}

Device_X_FASTWEB_AppCfg_.set = {
  IADFunction = function(mapping, param, value)
    uci_helper.set_on_uci(binding, value, commitapply)
    uci_helper.set_on_uci(mmpbxBinding, value, commitapply)
  end,
}

Device_X_FASTWEB_AppCfg_.commit = function()
  uci_helper.commit(binding)
  uci_helper.commit(mmpbxBinding)
end

Device_X_FASTWEB_AppCfg_.revert = function()
  uci_helper.revert(binding)
  uci_helper.revert(mmpbxBinding)
end

register(Device_X_FASTWEB_AppCfg_)
