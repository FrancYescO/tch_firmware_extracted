#!/bin/sh

REBOOT_OPTION=""

# parse options
while [ -n "$1" ]; do
	case "$1" in
		-S|--skip-signature) ;;
		-o) REBOOT_OPTION="--no-reboot -s";;
		--gui) ;;
		-*)
			echo "Invalid option: $1"
			exit 1
		;;
		*) break;;
	esac
	shift;
done

UPGRADE_URL="$1"

if [ -z $UPGRADE_URL ]; then
	echo "do not use this"
	echo "use sysupgrade  <URL>"
	echo "or sysupgrade -o -s <URL> to not active/reboot"
	echo ""
	echo "Usage: $0 {options} <url>"
	echo " Options:"
	echo "  [-S|--skip-signature] ignored"
	echo "  [-o] Only program inactive bank, do not activate, no reboot"
	echo "  [--gui] ignored"
	exit 1
fi
(sleep 120; uci set env.var.friendly_sw_version_passivebank=$(cat /proc/banktable/passiveversion); uci commit) & (exec sysupgrade $REBOOT_OPTION $UPGRADE_URL)
