<!--
  (C) 2016 NETDUMA Software
  Kian Cross
  Luke Meppem
--> <%
require "libos"
local platform = os.platform_information()
%> <link rel="import" href="/custom-elements/duma-panels/duma-panel.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/duma-map/duma-map.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/duma-image/duma-image.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/duma-zoom-slider/duma-zoom-slider.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/duma-location-search/duma-location-search.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/paper-checkbox/paper-checkbox.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/paper-slider/paper-slider.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/paper-progress/paper-progress.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/paper-toast/paper-toast.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/paper-radio-group/paper-radio-group.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/paper-radio-button/paper-radio-button.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/paper-toggle-button/paper-toggle-button.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/iron-icon/iron-icon.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/iron-icons/maps-icons.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/iron-icons/editor-icons.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/paper-button/paper-button.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/paper-tooltip/paper-tooltip.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/paper-dropdown-menu/paper-dropdown-menu.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/paper-icon-button/paper-icon-button.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/paper-dialog/paper-dialog.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/paper-spinner/paper-spinner-lite.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/duma-alert/duma-alert.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/duma-splash/duma-splash.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/iron-flex-layout/iron-flex-layout.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/custom-elements/iron-flex-layout/iron-flex-layout-classes.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/themes/<%= current_theme %>/duma-theme.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/libs/jquery.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/libs/rpc.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/libs/sampler.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/libs/devices.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/libs/q.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/libs/storage.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/libs/svg-util.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/nd-css/duma-icons.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/apps/com.netdumasoftware.geofilter/desktop/geo-filter.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <link rel="import" href="/apps/com.netdumasoftware.geofilter/desktop/geofilter-device-selector.html?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"> <style is="custom-style" include="iron-flex iron-flex-alignment iron-positioning duma-theme"> figure duma-image {
    display: inline;
  }
  figure duma-image ::content svg {
    display: block;
    margin: auto;
  }
  .flex-svg {
    min-height: 256px;
    position: relative;
  }
  .flex-svg > duma-map {
    width: 100%;
    left:0;
    height: 100%;
  }

  .profiles {
    margin: 18px 0 0 0;
  }

  #geo-unit {
    margin-right: 16px;
    margin-top: 18px;		
  }

  .geo-distance {
    margin: 0 16px;
  }

  .ping-unit  {
    margin-left: 8px;
  }

  .flex-1 {
    flex: 1 1 auto;
  }
  .flex-2 {
    flex: 2 1 auto;
  }
  .flex-3 {
    flex: 3 1 auto;
  }

  duma-map.home-cursor {
    cursor: url("/apps/com.netdumasoftware.geofilter/shared/icons/cursor-home.svg") 12 22, url("/apps/com.netdumasoftware.geofilter/shared/icons/cursor-home.cur"), crosshair;
  }
  duma-map.add-polygon-cursor {
    cursor: url("/apps/com.netdumasoftware.geofilter/shared/icons/cursor-edit.svg") 3 21, url("/apps/com.netdumasoftware.geofilter/shared/icons/cursor-edit.cur"), crosshair;
  }
  duma-map.delete-polygon-cursor ::content #polygons polygon:hover {
    cursor: pointer;
    fill-opacity: 0.3 !important;
  }

  .bottom-bar {
    @apply(--layout-horizontal);
    @apply(--layout-center);
    width: 100%;
    padding: 0 16px 16px 16px;
    box-sizing: border-box;
    background-color: var(--transparent-background-color);
    overflow: visible;
    padding-top: 1em;
  }
  .bottom-bar paper-toggle-button#filtering-mode {
    flex-shrink: 0;
  }
  paper-tooltip ::content #tooltip {
    background-color: var(--primary-background-color);
    opacity: 1;
    padding-left: 1em;
    padding-right: 1em;
    @apply(--paper-font-caption);
  }
  paper-slider ::content paper-input ::content paper-input-container ::content input[type="number"] {
    -moz-appearance:textfield;
  }
  .absolute-from-bottom {
    position: absolute;
    bottom: 0;
    width: 100%;
    pointer-events: none;
  }
  
  duma-zoom-slider,
  .geo-menu > *,
  .bottom-bar {
    pointer-events: all;
  }
  .polygon-count paper-progress {
    margin: 18px 0;
  }

  .geo-menu {
    @apply(--layout-horizontal);
    padding: 0 16px;
  }
  .geo-menu > paper-icon-button {
    border-radius: 50%;
    margin-right: 1em;
  }
  #geofilter-devices > div:first-child {
    margin-left: 1em;
  }
  #geofilter-devices {
    align-items: center;
  }
  .geo-device {
    text-align: left;
    white-space: nowrap;
    padding: 0px 12px 0px 12px;
    width: 164px;
    border-right: 1px solid var(--divider-color);
    border-radius: 2px;
    margin-right: 1.5em;
    height: 64px;
    position: relative;
    background-color: transparent;
    transition: background-color 0.3s;
  }
  .geo-device:hover,
  .geo-device:focus-within {
    background-color: var(--primary-background-color);
  }
  .geo-device .delete-box {
    position: absolute;
    width: 100%;
    background-color: var(--primary-background-color);
    display: flex;
    justify-content: flex-end;
    align-items: flex-end;
    height: 0em;
    width: 100%;
    opacity: 0;
    top: 100%;
    left: 0;
    transition: opacity 0.3s, height 0.3s 0.3s;
    z-index: 1;
  }
  #geo-map-panel ::content #drawer {
    z-index: 2;
  }
  .geo-device:hover .delete-box,
  .geo-device:focus-within .delete-box {
    opacity: 1;
    height: 3.5em;
    transition: opacity 0.3s, height 0s;
  }
  .geo-device .delete-box paper-button {
    color: var(--primary-color);
  }
  .geo-device div.service {
    overflow: hidden;
    width: 100%;
    text-overflow: ellipsis;
    color: var(--secondary-text-color);
  }
  .geo-device .device-name {
    margin-top: 0.3em;
    width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .geo-device .filter-toggle {
    padding: 0px 12px 0px 0px;
  }
  .absolute-from-bottom .zoom-slider-container {
    height: 256px;
    width: 40px;
    min-height: 128px;
    padding: 0 16px;
  }
  #geo-filter-tour-start {
    width: 30em;
  }
  .icon-legend-wrapper {
    position: relative;
    margin-left: auto;
    margin-top: auto;
  }
  .icon-legend {
    position: absolute;
    background-color: var(--transparent-background-color);
    display: flex;
    flex-direction: column;
    right: 0;
    padding: 8px;
    z-index: 88;
  }
  .icon-legend .legend-row {
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    white-space: nowrap;
    margin-top: 1em;
    margin-right: 2em;
  }
  .icon-legend .legend-row span {
    margin-left: 1em;
  }
  .icon-legend .legend-row iron-icon {
    fill: var(--geofilter-icon-color, --primary-text-color);
  }
  .icon-legend .legend-row iron-icon[type="server-blacklisted"],      
  .icon-legend .legend-row iron-icon[type="server-blocked"],
  .icon-legend .legend-row iron-icon[type="peer-blacklisted"],         
  .icon-legend .legend-row iron-icon[type="peer-blocked"] {
    fill: var(--geofilter-icon-blocked-color, --primary-text-color);
  } </style> <duma-panel header="<%= i18n.header %>" drawer-header="<%= i18n.drawerHeader %>" show-pin show-drawer show-help show-drawer-help show-help-tip id="geo-map-panel"> <div help-content> <p> <%= i18n.helpContent %> </p> <figure> <duma-image src="/apps/com.netdumasoftware.geofilter/desktop/help-images/geofilter-new.svg?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"></duma-image> </figure> <p> <%= platform.vendor ~= "TELSTRA" and i18n.helpContentTwo or "" %> </p> </div> <div help-tip> <%= i18n.helpTip %> </div> <div drawer-help-content> <p> <%= platform.vendor == "TELSTRA" and i18n.drawerHelpContentMinFast or i18n.drawerHelpContent %> </p> </div> <div drawer> <paper-radio-group selected="km" id="distance-unit"> <paper-radio-button name="km"><%= i18n.kilometres %></paper-radio-button> <paper-radio-button name="miles"><%= i18n.miles %></paper-radio-button> </paper-radio-group> <paper-checkbox id="strict-mode"><%= i18n.strictMode %></paper-checkbox> <paper-checkbox id="auto-ping"><%= i18n.autoPingHost %></paper-checkbox> <paper-button background id="flush-cloud"><%= i18n.flushCloud %></paper-button> <% if platform.vendor ~= "TELSTRA" then %> <paper-checkbox id="allow-false-positives"><%= i18n.fastSearch %></paper-checkbox> <% end %> </div> <div main class="layout vertical"> <div class="flex-none"> <div class="layout horizontal" role="region" aria-label="<%= i18n.ariaTopRegion %>"> <div id="geofilter-devices" class="layout horizontal"></div> <paper-button background id="add-device" style="margin: 16px;" aria-haspopup="true"> <%= i18n.addDevice %> </paper-button> <div class="icon-legend-wrapper"> <paper-checkbox checked="checked"><%= i18n.showIconLegend %></paper-checkbox> <div class="icon-legend"> <template id="iconLegendRepeat" is="dom-repeat"> <div class="legend-row"> <iron-icon icon="[[item.icon]]" type$="[[item.type]]"></iron-icon> <span>[[item.display]]</span> </div> </template> </div> </div> </div> </div> <div class="flex flex-svg"> <duma-map></duma-map> </div> <div class="flex-none absolute-from-bottom"> <div class="zoom-slider-container"> <duma-zoom-slider></duma-zoom-slider> </div> <div class="bottom-bar"> <paper-toggle-button id="filtering-mode" aria-label="<%= i18n.polygonMode %>"><%= i18n.polygonMode %></paper-toggle-button> <div class="geo-menu"> <!-- cannot tab to this button, as it is mouse-only feature, of clicking on the map --> <paper-icon-button icon="maps:person-pin-circle" id="home" aria-label="<%= i18n.buttonHome %>" tabindex="-1"></paper-icon-button> <paper-tooltip position="top" for="home" animation-delay="0" offset="0"><%= i18n.buttonHome %></paper-tooltip> <paper-icon-button icon="home" id="search-home" aria-label="<%= i18n.locationSearch %>" aria-haspopup="true"></paper-icon-button> <paper-tooltip position="top" for="search-home" animation-delay="0" offset="0"><%= i18n.locationSearch %></paper-tooltip> <paper-icon-button icon="editor:mode-edit" id="add-polygon" aria-label="<%= i18n.buttonDraw %>"></paper-icon-button> <paper-tooltip position="top" for="add-polygon" animation-delay="0" offset="0"><%= i18n.buttonDraw %></paper-tooltip> <paper-icon-button icon="icons:delete-forever" id="delete-polygon" aria-label="<%= i18n.buttonDelete %>"></paper-icon-button> <paper-tooltip position="top" for="delete-polygon" animation-delay="0" offset="0"><%= i18n.buttonDelete %></paper-tooltip> </div> <template class="template-when-circle" is="dom-if" if="true"> <div class="flex flex-3 geo-distance"> <div><%= i18n.setDistance %></div> <paper-slider pin editable class="flex-none" id="distance-slider" aria-label="<%= i18n.ariaDistanceSlider %>" aria-value-unit="<%= i18n.kmUnit %>"></paper-slider> </div> <div class="flex-none self-center" id="geo-unit"><%= i18n.kmUnit %></div> </template> <template class="template-when-polygon" is="dom-if" if="true"> <div class="flex flex-3 geo-distance polygon-count"> <div><%= i18n.pointsRemaining %>: <span id="polygon-text-count">0</span></div> <paper-progress class="flex-none transiting" id="polygon-count" max="50" min="0"></paper-progress> </div> </template> <% if platform.vendor ~= "TELSTRA" then %> <div class="flex flex-2 geo-distance"> <div><%= i18n.pingAssist %></div> <paper-slider id="ping-assist" min="0" max="200" editable aria-label="<%= i18n.pingAssist %>" aria-value-unit="<%= i18n.ariaPingAssistSliderUnit %>"></paper-slider> </div> <% end %> <template class="template-when-circle" is="dom-if" if="true"> <paper-button background id="profiles"><%= i18n.profiles %></paper-button> </template> </div> </div> <paper-toast id="cloudToast" duration="0" text="<%= i18n.unableToAccessCloudError %>"></paper-toast> <paper-toast id="homeLocationChangedToast" text="<%= i18n.homeLocationChanged %>"></paper-toast> <paper-dialog id="geo-map-loader-dialog" modal> <h2 dialog-label><%= i18n.loaderDialogHeading %></h2> <div class="layout horizontal center-justified"> <paper-spinner-lite></paper-spinner-lite> </div> </paper-dialog> <duma-alert id="geofilter-duma-alert"></duma-alert> <paper-dialog id="devices-loader-dialog" modal> <h2 dialog-label><%= i18n.applyingSettings %></h2> <div class="layout horizontal center-justified"> <paper-spinner-lite></paper-spinner-lite> </div> </paper-dialog> <geofilter-device-selector></geofilter-device-selector> <duma-location-search header="<%= i18n.locationSearchHeader %>" save-text="<%= i18n.locationSearchSaveButton %>"> <div description id="locationSearchDescription"> <%= i18n.locationSearchDescription %> </div> </duma-location-search> <duma-alert id="filtering-success"> <h2><%= i18n.filteringSuccessTitle %></h2> <p><%= i18n.filteringSuccessMessage1 %></p> <p><%= i18n.filteringSuccessMessage2 %></p> </duma-alert> <duma-alert id="spectating-success"> <h2><%= i18n.spectatingSuccessTitle %></h2> <p><%= i18n.specatingSuccessMessage %></p> </duma-alert> <duma-alert id="polygon-keyboard-warning"> <%= i18n.polygonCursorWarn %> </duma-alert> <duma-splash id="geo-filter-tour-start" title="<%= i18n.tourHeader %>"> <p> <%= i18n.tourBrief %> </p> <figure> <duma-image src="/apps/com.netdumasoftware.geofilter/desktop/help-images/geofilter-new.svg?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"></duma-image> </figure> </duma-splash> </div> </duma-panel> <script src="/apps/com.netdumasoftware.geofilter/desktop/geo-map.js?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"></script> <script src="/apps/com.netdumasoftware.geofilter/desktop/devices.js?v=<%= dumaos_version %>&lang=<%= lang %>&theme=<%= current_theme %>&themeVersion=<%= current_theme_version %>"></script> 