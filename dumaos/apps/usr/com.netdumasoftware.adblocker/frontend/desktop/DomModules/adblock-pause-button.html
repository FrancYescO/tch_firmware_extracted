<link rel="import" href="/custom-elements/paper-icon-button/paper-icon-button.html"> <link rel="import" href="/custom-elements/paper-menu-button/paper-menu-button.html"> <link rel="import" href="/custom-elements/paper-item/paper-item.html"> <link rel="import" href="/custom-elements/paper-listbox/paper-listbox.html"> <link rel="import" href="/custom-elements/iron-icons/av-icons.html"> <!-- Theme, loaded last --> <link rel="import" href="/themes/<%= current_theme %>/duma-theme.html"> <dom-module id="adblock-pause-button"> <template> <style include="duma-theme iron-flex"> :host  {
        display: block;
      }
      paper-icon-button {
        --paper-icon-button: {
          margin: 8px;
        };
      }
      paper-menu-button paper-icon-button {
        --paper-icon-button: {
          margin: 0;
        };
      }
      paper-menu-button paper-button {
        margin: 8px 16px;
      } </style> <iron-pages selected="[[showPlayPause]]"> <div> <paper-icon-button on-tap="EnableDevice" icon="av:play-arrow" disabled="[[!internalAdblockEnabled]]"></paper-icon-button> </div> <div> <paper-menu-button disabled="[[!internalAdblockEnabled]]"> <paper-icon-button id="pauseButton" icon="av:pause" class="dropdown-trigger" alt="menu"></paper-icon-button> <paper-listbox class="dropdown-content"> <paper-item on-tap="DisableDevice" data-time="60">1 min</paper-item> <paper-item on-tap="DisableDevice" data-time="300">5 mins</paper-item> <paper-item on-tap="DisableDevice" data-time="600">10 mins</paper-item> <paper-item on-tap="DisableDevice" data-time="1800">30 mins</paper-item> <paper-item on-tap="DisableDevice" data-time="2700">45 mins</paper-item> <paper-item on-tap="DisableDevice" data-time="3600">60 mins</paper-item> <template is="dom-if" if="[[!disableButton]]"> <paper-button on-tap="DisableDevice" data-time="0" background>Disable</paper-button> </template> </paper-listbox> </paper-menu-button> </div> </iron-pages> </template> <script> Polymer(
    {
      is: 'adblock-pause-button',
      properties:
      {
        disableButton:
        {
          type: Boolean,
          value: false,
        },
        DeviceEnabled:
        {
          type: Boolean,
          value: true,
        },
        DeviceID:
        {
          type: Number,
          value: -1,
        },
        disabledRemainder:
        {
          type: Number,
          value: -1,
          notify: true,
          observer: "DisabledRemainderChanged"
        },
        adblockEnabled:
        {
          type: Boolean,
          value: false,
          notify: true,
        },
        internalAdblockEnabled:
        {
          type: Boolean,
          computed: "IsAdblockEnabled(adblockEnabled, DeviceID, disabledRemainder)",
        },
        showPlayPause:
        {
          type: Boolean,
          computed: "ShouldShowPlayPause(DeviceEnabled, DeviceID, adblockEnabled)"
        }
      },
      DisabledRemainderChanged(time, oldValue)
      {
        if (this.disableTimeoutID)
          clearTimeout(this.disableTimeoutID);

        if (time === -1)
          return;

        this.disableTimeoutID = setTimeout(function ()
        {
          this.DeviceEnabled = true;
          if (this.DeviceID === -1)
            this.adblockEnabled = true;
            this.disabledRemainder = -1;
        }.bind(this), time * 1000);
      },
      EnableDevice()
      {
        this.DeviceEnabled = true;
        if (this.DeviceID === -1)
          long_rpc_promise("com.netdumasoftware.adblocker", "enable", [true, 0]).done(this.GlobalEnabledCallback.bind(this));
        else
        {
          long_rpc_promise("com.netdumasoftware.adblocker", "enable_device", [this.DeviceID, true, 0]);
          this.disabledRemainder = -1;
        }
      },
      DisableDevice(event)
      {
        var time = event.target.dataset.time;

        if (this.DeviceID === -1)
          long_rpc_promise("com.netdumasoftware.adblocker", "enable", [false, time]).done(this.GlobalEnabledCallback.bind(this))
        else
        {
          long_rpc_promise("com.netdumasoftware.adblocker", "enable_device", [this.DeviceID, false, time]);
          this.disabledRemainder = parseInt(time);
        }

        this.DeviceEnabled = false;
      },
      IsAdblockEnabled(adblockEnabled, DeviceID, disabledRemainder)
      {
        if (DeviceID === -1)
          return adblockEnabled || disabledRemainder >= 0;
        return adblockEnabled;
      },
      ShouldShowPlayPause(DeviceEnabled, DeviceID, adblockEnabled)
      {
        if (DeviceID == -1)
          return adblockEnabled;
        return DeviceEnabled;
      },
      GlobalEnabledCallback(result)
      {
        this.adblockEnabled = result[0].enabled;
        this.disabledRemainder = parseInt(result[0].disabled_for);
      },
    }); </script> </dom-module> 