(function(t){if(typeof exports==="object"){module.exports=t(require("jquery"))}else if(typeof define==="function"&&define.amd){define(["jquery"],t)}else{t(jQuery)}})(function(t){"use strict";var i={},s=Math.max,h=Math.min;i.c={};i.c.d=t(document);i.c.t=function(t){return t.originalEvent.touches.length-1};i.o=function(){var s=this;this.o=null;this.$=null;this.i=null;this.g=null;this.v=null;this.cv=null;this.x=0;this.y=0;this.w=0;this.h=0;this.$c=null;this.c=null;this.t=0;this.isInit=false;this.fgColor=null;this.pColor=null;this.dH=null;this.cH=null;this.eH=null;this.rH=null;this.scale=1;this.relative=false;this.relativeWidth=false;this.relativeHeight=false;this.$div=null;this.run=function(){var i=function(t,i){var h;for(h in i){s.o[h]=i[h]}s._carve().init();s._configure()._draw()};if(this.$.data("kontroled"))return;this.$.data("kontroled",true);this.extend();this.o=t.extend({min:this.$.data("min")||0,max:this.$.data("max")||100,stopper:true,readOnly:this.$.data("readonly")||this.$.attr("readonly")=="readonly",scroll:this.$.data("scroll")||true,cursor:this.$.data("cursor")===true&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")&&Math.max(Math.min(this.$.data("thickness"),1),.01)||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:this.$.data("displayinput")==null||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor"),font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:false,step:this.$.data("step")||1,rotation:this.$.data("rotation"),draw:null,change:null,cancel:null,release:null,format:function(t){return t},parse:function(t){return parseFloat(t)}},this.o);this.o.flip=this.o.rotation==="anticlockwise"||this.o.rotation==="acw";if(!this.o.inputColor){this.o.inputColor=this.o.fgColor}if(this.$.is("fieldset")){this.v={};this.i=this.$.find("input");this.i.each(function(i){var h=t(this);s.i[i]=h;s.v[i]=s.o.parse(h.val());h.bind("change blur",function(){var t={};t[i]=h.val();s.val(s._validate(t));var e=s._validate(t);if(s.cH&&s.cH(e)===false)return;s.val(e)})});this.$.find("legend").remove()}else{this.i=this.$;this.v=this.o.parse(this.$.val());this.v===""&&(this.v=this.o.min);this.$.bind("change blur",function(){var t=s._validate(s.o.parse(s.$.val()));if(s.cH&&s.cH(t)===false)return;s.val(t)})}!this.o.displayInput&&this.$.hide();this.$c=t(document.createElement("canvas")).attr({width:this.o.width,height:this.o.height});this.$div=t('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+"px;"+'"></div>');this.$.wrap(this.$div).before(this.$c);this.$div=this.$.parent();if(typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(this.$c[0])}this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null;if(!this.c){throw{name:"CanvasNotSupportedException",message:"Canvas not supported. Please use excanvas on IE8.0.",toString:function(){return this.name+": "+this.message}}}this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1);this.relativeWidth=this.o.width%1!==0&&this.o.width.indexOf("%");this.relativeHeight=this.o.height%1!==0&&this.o.height.indexOf("%");this.relative=this.relativeWidth||this.relativeHeight;this._carve();if(this.v instanceof Object){this.cv={};this.copy(this.v,this.cv)}else{this.cv=this.v}this.$.bind("configure",i).parent().bind("configure",i);this._listen()._configure()._xy().init();this.isInit=true;this.$.val(this.o.format(this.v));this._draw();return this};this._carve=function(){if(this.relative){var t=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width)/100:this.$div.parent().width(),i=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height)/100:this.$div.parent().height();this.w=this.h=Math.min(t,i)}else{this.w=this.o.width;this.h=this.o.height}this.$div.css({width:this.w+"px",height:this.h+"px"});this.$c.attr({width:this.w,height:this.h});if(this.scale!==1){this.$c[0].width=this.$c[0].width*this.scale;this.$c[0].height=this.$c[0].height*this.scale;this.$c.width(this.w);this.$c.height(this.h)}return this};this._draw=function(){var t=true;s.g=s.c;s.clear();s.dH&&(t=s.dH());t!==false&&s.draw()};this._touch=function(t){var h=function(t){var i=s.xy2val(t.originalEvent.touches[s.t].pageX,t.originalEvent.touches[s.t].pageY);if(i==s.cv)return;if(s.cH&&s.cH(i)===false)return;s.change(s._validate(i));s._draw()};this.t=i.c.t(t);h(t);i.c.d.bind("touchmove.k",h).bind("touchend.k",function(){i.c.d.unbind("touchmove.k touchend.k");s.val(s.cv)});return this};this._mouse=function(t){var h=function(t){var i=s.xy2val(t.pageX,t.pageY);if(i==s.cv)return;if(s.cH&&s.cH(i)===false)return;s.change(s._validate(i));s._draw()};h(t);i.c.d.bind("mousemove.k",h).bind("keyup.k",function(t){if(t.keyCode===27){i.c.d.unbind("mouseup.k mousemove.k keyup.k");if(s.eH&&s.eH()===false)return;s.cancel()}}).bind("mouseup.k",function(t){i.c.d.unbind("mousemove.k mouseup.k keyup.k");s.val(s.cv)});return this};this._xy=function(){var t=this.$c.offset();this.x=t.left;this.y=t.top;return this};this._listen=function(){if(!this.o.readOnly){this.$c.bind("mousedown",function(t){t.preventDefault();s._xy()._mouse(t)}).bind("touchstart",function(t){t.preventDefault();s._xy()._touch(t)});this.listen()}else{this.$.attr("readonly","readonly")}if(this.relative){t(window).resize(function(){s._carve().init();s._draw()})}return this};this._configure=function(){if(this.o.draw)this.dH=this.o.draw;if(this.o.change)this.cH=this.o.change;if(this.o.cancel)this.eH=this.o.cancel;if(this.o.release)this.rH=this.o.release;if(this.o.displayPrevious){this.pColor=this.h2rgba(this.o.fgColor,"0.4");this.fgColor=this.h2rgba(this.o.fgColor,"0.6")}else{this.fgColor=this.o.fgColor}return this};this._clear=function(){this.$c[0].width=this.$c[0].width};this._validate=function(t){var i=~~((t<0?-.5:.5)+t/this.o.step)*this.o.step;return Math.round(i*100)/100};this.listen=function(){};this.extend=function(){};this.init=function(){};this.change=function(t){};this.val=function(t){};this.xy2val=function(t,i){};this.draw=function(){};this.clear=function(){this._clear()};this.h2rgba=function(t,i){var s;t=t.substring(1,7);s=[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)];return"rgba("+s[0]+","+s[1]+","+s[2]+","+i+")"};this.copy=function(t,i){for(var s in t){i[s]=t[s]}}};i.Dial=function(){i.o.call(this);this.startAngle=null;this.xy=null;this.radius=null;this.lineWidth=null;this.cursorExt=null;this.w2=null;this.PI2=2*Math.PI;this.extend=function(){this.o=t.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:true},this.o)};this.val=function(t,i){if(null!=t){t=this.o.parse(t);if(i!==false&&t!=this.v&&this.rH&&this.rH(t)===false){return}this.cv=this.o.stopper?s(h(t,this.o.max),this.o.min):t;this.v=this.cv;this.$.val(this.o.format(this.v));this._draw()}else{return this.v}};this.xy2val=function(t,i){var e,n;e=Math.atan2(t-(this.x+this.w2),-(i-this.y-this.w2))-this.angleOffset;if(this.o.flip){e=this.angleArc-e-this.PI2}if(this.angleArc!=this.PI2&&e<0&&e>-.5){e=0}else if(e<0){e+=this.PI2}n=e*(this.o.max-this.o.min)/this.angleArc+this.o.min;this.o.stopper&&(n=s(h(n,this.o.max),this.o.min));return n};this.listen=function(){var i=this,e,n,a=function(t){t.preventDefault();var a=t.originalEvent,o=a.detail||a.wheelDeltaX,r=a.detail||a.wheelDeltaY,l=i._validate(i.o.parse(i.$.val()))+(o>0||r>0?i.o.step:o<0||r<0?-i.o.step:0);l=s(h(l,i.o.max),i.o.min);i.val(l,false);if(i.rH){clearTimeout(e);e=setTimeout(function(){i.rH(l);e=null},100);if(!n){n=setTimeout(function(){if(e)i.rH(l);n=null},200)}}},o,r,l=1,c={37:-i.o.step,38:i.o.step,39:i.o.step,40:-i.o.step};this.$.bind("keydown",function(e){var n=e.keyCode;if(n>=96&&n<=105){n=e.keyCode=n-48}o=parseInt(String.fromCharCode(n));if(isNaN(o)){n!==13&&n!==8&&n!==9&&n!==189&&(n!==190||i.$.val().match(/\./))&&e.preventDefault();if(t.inArray(n,[37,38,39,40])>-1){e.preventDefault();var a=i.o.parse(i.$.val())+c[n]*l;i.o.stopper&&(a=s(h(a,i.o.max),i.o.min));i.change(i._validate(a));i.cH(a);i._draw();r=window.setTimeout(function(){l*=2},30)}}}).bind("keyup",function(t){if(isNaN(o)){if(r){window.clearTimeout(r);r=null;l=1;i.val(i.$.val())}}else{i.$.val()>i.o.max&&i.$.val(i.o.max)||i.$.val()<i.o.min&&i.$.val(i.o.min)}});if(i.o.scroll){this.$c.bind("mousewheel DOMMouseScroll",a);this.$.bind("mousewheel DOMMouseScroll",a)}};this.init=function(){if(this.v<this.o.min||this.v>this.o.max){this.v=this.o.min}this.$.val(this.v);this.w2=this.w/2;this.cursorExt=this.o.cursor/100;this.xy=this.w2*this.scale;this.lineWidth=this.xy*this.o.thickness;this.lineCap=this.o.lineCap;this.radius=this.xy-this.lineWidth/2;this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset);this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc);this.angleOffset=this.o.angleOffset*Math.PI/180;this.angleArc=this.o.angleArc*Math.PI/180;this.startAngle=1.5*Math.PI+this.angleOffset;this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var t=s(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.w/2+4>>0)+"px",height:(this.w/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.w/3>>0)+"px","margin-left":"-"+(this.w*3/4+2>>0)+"px",border:0,background:"none",font:this.o.fontWeight+" "+(this.w/t>>0)+"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})};this.change=function(t){this.cv=t;this.$.val(this.o.format(t))};this.angle=function(t){return(t-this.o.min)*this.angleArc/(this.o.max-this.o.min)};this.arc=function(t){var i,s;t=this.angle(t);if(this.o.flip){i=this.endAngle+1e-5;s=i-t-1e-5}else{i=this.startAngle-1e-5;s=i+t+1e-5}this.o.cursor&&(i=s-this.cursorExt)&&(s=s+this.cursorExt);return{s:i,e:s,d:this.o.flip&&!this.o.cursor}};this.draw=function(){var t=this.g,i=this.arc(this.cv),s,h=1;t.lineWidth=this.lineWidth;t.lineCap=this.lineCap;if(this.o.bgColor!=="none"){t.beginPath();t.strokeStyle=this.o.bgColor;t.arc(this.xy,this.xy,this.radius,this.endAngle-1e-5,this.startAngle+1e-5,true);t.stroke()}if(this.o.displayPrevious){s=this.arc(this.v);t.beginPath();t.strokeStyle=this.pColor;t.arc(this.xy,this.xy,this.radius,s.s,s.e,s.d);t.stroke();h=this.cv==this.v}t.beginPath();t.strokeStyle=h?this.o.fgColor:this.fgColor;t.arc(this.xy,this.xy,this.radius,i.s,i.e,i.d);t.stroke()};this.cancel=function(){this.val(this.v)}};t.fn.dial=t.fn.knob=function(s){return this.each(function(){var h=new i.Dial;h.o=s;h.$=t(this);h.run()}).parent()}});
