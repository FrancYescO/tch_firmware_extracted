config_load wee

config_get val common enabled
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_ENABLED="$val"
fi

config_get val cs enabled
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_ENABLED="$val"
fi

config_get val cs steering_rssi_threshold
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_STEERING_RSSI_THRESHOLD="$val"
fi

config_get val cs monitor_rssi_threshold
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_MONITOR_RSSI_THRESHOLD="$val"
fi

config_get val cs target_bss_sel_bcn_threshold
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_TARGET_BSS_SEL_BCN_THRESHOLD="$val"
fi

config_get val cs target_bss_sel_usm_threshold
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_TARGET_BSS_SEL_USM_THRESHOLD="$val"
fi

config_get val cs target_bss_sel_timeout
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_TARGET_BSS_SEL_TIMEOUT="$val"
fi

config_get val cs steering_hold_duration
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_STEERING_HOLD_DURATION="$val"
fi

config_get val cs steering_participation_hold
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_STEERING_PARTICIPATION_HOLD="$val"
fi

config_get val cs periodic_usm_enable
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_PERIODIC_USM_ENABLE="$val"
fi

config_get val cs usm_query_interval
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_USM_QUERY_INTERVAL="$val"
fi

config_get val cs usm_report_age
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_USM_REPORT_AGE="$val"
fi

config_get val cs bcn_report_age
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_BCN_REPORT_AGE="$val"
fi

config_get val cs enable_mac_acl
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_ENABLE_MAC_ACL="$val"
fi

config_get val cs enable_band_steering
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_ENABLE_BAND_STEERING="$val"
fi

config_get val cs steering_retry_count
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_STEERING_RETRY_COUNT="$val"
fi

config_get val cs rssi_hysterisys
if [ -n "$val" ]; then
    procd_append_param env ENV_WEE_CS_RSSI_HYSTERISYS="$val"
fi

config_get val cs rcpi_advanced_pred
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_ENABLE_RCPI_ADVANCED_PRED="$val"
fi

config_get val cs rcpi_advanced_upper_range
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_RCPI_ADVANCED_UPPER_RANGE="$val"
fi

config_get val cs rcpi_advanced_lower_range
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_RCPI_ADVANCED_LOWER_RANGE="$val"
fi

config_get val common log_level
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_LOG_LEVEL="$val"
fi

config_get val cs tbs_fail_policy
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_TARGET_BSS_FAILURE_POLICY="$val"
fi

config_get val cs steering_with_deauth
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_STEERING_WITH_DEAUTH="$val"
fi

config_get val cs disassoc_imminent
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_IS_DISASSOC_IMMINENT="$val"
fi

config_get val cs sta_failcnt_threshold
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_STA_FAILCNT_THRESHOLD="$val"
fi

config_get val cs sta_blacklisting_enabled
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_STA_BLACKLISTING_ENABLED="$val"
fi

config_get val cs sta_failcnt_mon_window
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_STA_FAILCNT_MONITOR_WDOW="$val"
fi

config_get val cs sta_blacklist_window
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_STA_BLACKLIST_WINDOW="$val"
fi

config_get val cs skip_non_11v_sta
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_SKIP_NON_11V_STA_STEERING="$val"
fi

config_get val cs 5G_bandsteer_thresh
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_BSTEER_5G_RSSI_THRESH="$val"
fi

config_get val cs 2G_bandsteer_thresh
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_BSTEER_2G_RSSI_THRESH="$val"
fi

config_get val cs bandsteer_hold_time
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_BANDSTEER_HOLD_WINDOW="$val"
fi

config_get val cs deauth_ratelimit_window
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_DEAUTH_RATE_LIMIT_WINDOW="$val"
fi

config_get val cs deauth_max_count
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_MAX_DEAUTH_CNT="$val"
fi

config_get val cs deauth_ratelimit_enabled
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_RATE_LIMIT_DEAUTH_ENABLED="$val"
fi

config_get val cs steer_desicion_instantaneous
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_STEER_INSTANTANEOUS="$val"
fi

config_get val cs rssi_priority_error_margin
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BS_RSSI_PREDICT_PRIORITY_ERROR_MARGIN="$val"
fi

config_get val cs rssi_prediction_disabled
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_DISABLE_RSSI_PREDICTION="$val"
fi

config_get val cs bandsteer_priority_one
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BS_PRIORITY_ONE_CANDIDATE="$val"
fi

config_get val cs bandsteer_priority_two
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BS_PRIORITY_TWO_CANDIDATE="$val"
fi

config_get val cs bandsteer_priority_three
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BS_PRIORITY_THREE_CANDIDATE="$val"
fi

config_get val cs bandsteer_priority_four
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BS_PRIORITY_FOUR_CANDIDATE="$val"
fi

config_get val cs bandsteer_5g_thresh_hardlimit
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BSTEER_5G_THRESH_HARDLIMIT="$val"
fi

config_get val cs bandsteer_2g_thresh_hardlimit
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BSTEER_2G_THRESH_HARDLIMIT="$val"
fi

config_get val cs bandsteer_sta_himself_roamed_detection_window
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BANDSTEER_STA_HIMSELF_ROAMED_DETECTION_WINDOW="$val"
fi

config_get val cs bandsteer_multibss_macacl_deauth
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_BANDSTEER_MULTIBSS_MACACL_DEAUTH_ENABLED="$val"
fi

config_get val cs bandsteer_multibss_macacl_blocktime
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_BANDSTEER_MULTIBSS_MACACL_BLOCK_TIME="$val"
fi

config_get val cs bandsteer_loop_mon_period
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_INFINITE_LOOP_BANDSTEER_MON_PERIOD="$val"
fi

config_get val cs bandsteer_loop_attempt_cnt_thresh
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_INFINITE_LOOP_BANDSTEER_ATTEMPT_CNT_THRESH="$val"
fi

config_get val cs apsteer_loop_mon_period
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_INFINITE_LOOP_APSTEER_MON_PERIOD="$val"
fi

config_get val cs apsteer_loop_attempt_cnt_thresh
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_INFINITE_LOOP_APSTEER_ATTEMPT_CNT_THRESH="$val"
fi

config_get val topo_optimisation link_metric_query_interval
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_LINK_METRICS_QUERY_INTERVAL="$val"
fi

config_get val topo_optimisation enabled
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_TOPO_OPT_ENABLED="$val"
fi

config_get val topo_optimisation bh_link_rssi_threshold
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_TOPO_OPT_RSSI_THRESHOLD="$val"
fi


config_get val topo_optimisation metrics_gather_timeout
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_TOPO_OPT_METRICS_GATHER_TIMEOUT="$val"
fi


config_get val topo_optimisation topo_settling_timeout
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_TOPO_OPT_SETTLING_TIMEOUT="$val"
fi


config_get val topo_optimisation topo_steering_timeout
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_TOPO_OPT_STEERING_TIMEOUT="$val"
fi


config_get val topo_optimisation metrics_gather_retry_cnt
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_TOPO_OPT_METRICS_GATHER_RETRY_CNT="$val"
fi


config_load multiap
config_get map_agent_enabled agent enabled
if [ -n "$map_agent_enabled" ]; then
    config_load env
    config_get val var local_wifi_mac
    if [ -n "$val" ]; then
        uci_set "wee" "topo_optimisation" "root_mac" "$val"
        uci commit
        procd_append_param env ENV_WEE_TOPO_OPT_ROOT_MAC="$val"
    fi
fi

config_get val topo_optimisation root_mac
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_TOPO_OPT_ROOT_MAC="$val"
fi


config_get val topo_optimisation macacl_enabled
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_TOPO_OPT_MULTIBSS_MACACL_ENABLED="$val"
fi


config_get val topo_optimisation macacl_timeout
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_TOPO_OPT_MULTIBSS_MACACL_FLUSH_TIMEOUT="$val"
fi

config_get val topo_optimisation bh_eth_update_timeout
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_TOPO_OPT_ETH_LINK_CHANGE_TIMEOUT="$val"
fi

config_get val topo_optimisation link_metrics_query_interval
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_LINK_METRICS_QUERY_INTERVAL="$val"
fi


config_get val cs enable_split_ssid_override
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_ENABLE_SPLIT_SSID_OVERRIDE="$val"
fi

config_get val cs bandsteer_steer_window
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_BANDSTEER_STEER_WINDOW="$val"
fi

config_get val cs apsteer_steer_window
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_APSTEER_STEER_WINDOW="$val"
fi

config_get val cs bandsteer_multibss_11v_enabled 
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_BANDSTEER_MULTIBSS_MACACL_11V_STEER_ENABLED="$val"
fi

config_get val cs bandsteer_allow_non11v
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_BANDSTEER_ALLOW_NON_11V="$val"
fi

config_get val cs bandsteer_failure_bkoff
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_BANDSTEER_FAILURE_BKOFF="$val"
fi

config_get val cs bandsteer_dualband_unknown_sta_enabled
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_BANDSTEER_DUALBAND_UNKNOWN_STA_ENABLED="$val"
fi

config_get val cs sta_disconnect_evt_timeout
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_STA_DISCONNECT_EVT_TIMEOUT="$val"
fi

config_get val cs sta_assoc_rssi_measurement_timeout
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_STA_ASSOC_RSSI_MEASUREMENT_TIMEOUT="$val"
fi

config_get val cs bandsteer_dual_band_detection_retry_interval
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_DUAL_BAND_DETECTION_RETRY_INTERVAL="$val"
fi

config_get val cs bandsteer_dual_band_detection_retry_cnt
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_DUAL_BAND_DETECTION_MAX_RETRY="$val"
fi

config_get val cs bandsteer_2g_rssi_hysterisys
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_BS_2G_RSSI_HYSTERISYS="$val"
fi

config_get val cs bandsteer_5g_rssi_hysterisys
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_BS_5G_RSSI_HYSTERISYS="$val"
fi


config_get val cs bandsteer_2g_thresh_adjust_offset
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BANDSTEER_2G_THRESH_ADJUST_OFFSET="$val"
fi


config_get val cs bandsteer_5g_thresh_adjust_offset
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BANDSTEER_5G_THRESH_ADJUST_OFFSET="$val"
fi


config_get val cs bandsteer_2G_reset_threshold
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BANDSTEER_2G_RESET_THRESH="$val"
fi


config_get val cs bandsteer_5G_reset_threshold
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BANDSTEER_5G_RESET_THRESH="$val"
fi


config_get val cs bandsteer_2G_thresh_margin
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BANDSTEER_2G_THRESH_MARGIN="$val"
fi

config_get val cs bandsteer_5G_thresh_margin
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BANDSTEER_5G_THRESH_MARGIN="$val"
fi


config_get val cs bandsteer_min_assoc_rssi_failcnt
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BANDSTEER_MIN_ASSOC_RSSI_FAILCNT="$val"
fi


config_get val cs spike_detection_failcnt
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_SPIKE_DETECTION_FAILCNT="$val"
fi


config_get val cs bandsteer_reset_thresh_failcnt
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_BANDSTEER_RESET_THRESH_FAILCNT="$val"
fi


config_get val cs reverse_bandsteer_steer_window
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_TBS_FALLBACK_REVERSE_BANDSTEER_STEER_WINDOW="$val"
fi

config_get val cs wildcard_steering_with_deauth
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_WILDCARD_STEERING_WITH_DEAUTH="$val"
fi


config_get val cs tbs_failure_fallback_policy
if [ -n "$val" ]; then
  procd_append_param env ENV_WEE_CS_TARGET_BSS_FAILURE_FALLBACK="$val"
fi

config_get wee_donotsteer_enabled donotsteer enabled
if [ -n "$wee_donotsteer_enabled" ]; then
  procd_append_param env ENV_WEE_DONOTSTEER_ENABLED=$wee_donotsteer_enabled
fi

donotsteer_maclist=$(uci get wee.donotsteer.donotsteer_list)
donotsteer_maclist=${donotsteer_maclist// /,}
if [ -n "$donotsteer_maclist" ]; then
  procd_append_param env ENV_WEE_DONOTSTEER_MAC_LIST=$donotsteer_maclist
fi
