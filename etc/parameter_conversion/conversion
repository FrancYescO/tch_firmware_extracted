debug_on

copy_file /etc/config/button

copy_file /etc/config/dropbear

copy_file /etc/config/dhcprelay

copy_file /etc/config/dhcpsnooping

copy_file /etc/config/ledfw

#ethoam
uci_set ethoam.global.enable

# cwmpd
copy_file /etc/cwmpd.db
copy_file /etc/config/cwmp_transfer
inline_sh_cmd /usr/lib/cwmpd/transfers/rollback_check.sh %%OLDCONFIG%%
uci_section cwmpd.cwmpd_config

#transformer
copy_dir /usr/share/transformer
copy_dir /usr/lib/lua

uci_set cwmpd.cwmpd_config.acs_url
uci_set cwmpd.cwmpd_config.state
uci_set cwmpd.cwmpd_config.upgradesmanaged
uci_set cwmpd.cwmpd_config.connectionrequest_auth
uci_set cwmpd.cwmpd_config.periodicinform_enable
uci_set cwmpd.cwmpd_config.periodicinform_interval
uci_set cwmpd.cwmpd_config.interface
uci_set cwmpd.cwmpd_config.connectionrequest_port
uci_set cwmpd.cwmpd_config.acs_user
uci_set cwmpd.cwmpd_config.acs_pass
uci_set cwmpd.cwmpd_config.connectionrequest_password
uci_set cwmpd.cwmpd_config.connectionrequest_username

#dyndns
uci_set ddns.myddns.enabled ddns.myddns_ipv4.enabled
uci_set ddns.myddns.service_name ddns.myddns_ipv4.service_name
uci_set ddns.myddns.domain ddns.myddns_ipv4.domain
uci_set ddns.myddns.username ddns.myddns_ipv4.username
uci_set ddns.myddns.password ddns.myddns_ipv4.password
uci_set ddns.myddns.lookup_host ddns.myddns_ipv4.lookup_host
uci_del ddns.myddns

uci_set ddns.myddns_ipv4.enabled
uci_set ddns.myddns_ipv4.service_name
uci_set ddns.myddns_ipv4.domain
uci_set ddns.myddns_ipv4.username
uci_set ddns.myddns_ipv4.password
uci_set ddns.myddns_ipv4.lookup_host
inline_sh_cmd lua -e \"uc=require 'uciconv' o=uc.uci('old') n=uc.uci('new') v=o:get('ddns','myddns_ipv4','service_name') if (v == 'No-IP.com' or v == 'NoIP.com' or v == 'noip.com') then n:set('ddns','myddns_ipv4','service_name','no-ip.com') end n:commit('ddns')\"



#DHCP

#Take the interfaces configured in DNSMASQ
uci_list dhcp.@dnsmasq[0].interface

#Take DHCP client classifiers over too
uci_section dhcp.@mac
uci_section dhcp.@vendorclass
uci_section dhcp.@userclass
uci_section dhcp.@circuitid
uci_section dhcp.@remoteid
uci_section dhcp.@subscrid

uci_set dhcp.odhcpd.leasefile
uci_set dhcp.odhcpd.leasetrigger

uci_section dhcp.@dhcp


#uci_set dhcp.wan.interface
#uci_set dhcp.wan.ignore
inline_sh_cmd lua -e \"uc=require 'uciconv' o=uc.uci('old') n=uc.uci('new') v=o:get('dhcp','wan','ignore') if (v == '1') then n:set('dhcp','wan','dhcpv4','disabled') else n:set('dhcp','wan','dhcpv4','server') end n:commit('dhcp')\"
uci_section dhcp.@host id=name
inline_sh_cmd lua -e \"uc=require 'uciconv' o=uc.uci('old') n=uc.uci('new') v=o:get('dhcp','lan','ignore') if (v == '1') then n:set('dhcp','lan','dhcpv4','disabled') else n:set('dhcp','lan','dhcpv4','server') end n:commit('dhcp')\"

uci_section dhcp.@relay
inline_sh_cmd lua /etc/parameter_conversion/scripts/convdhcprelay.lua

copy_file /etc/config/dscp2pbit



uci_section firewall.@userrule id=name
uci_section firewall.@userrule_v6 id=name
uci_section firewall.@fwconfig
uci_section firewall.@zone id=name
uci_set firewall.defaultoutgoing.target
uci_set firewall.normalrules.enabled
uci_set firewall.laxrules.enabled
uci_set firewall.highrules.enabled
uci_set firewall.userrules.enabled
uci_set firewall.userrules_v6.enabled
uci_set firewall.defaultrules.enabled
#Unnumbered src
uci_set firewall.wan.masq_src

uci_section firewall.@userredirect
uci_section firewall.@forwarding id=name
uci_section firewall.fwdassist
#Copy ALG Settings 
uci_set firewall.@helper.enable

uci_set firewall.userredirects.enabled
uci_set firewall.defaultoutgoing.target
uci_set firewall.@dmzredirect[0].dest_ip firewall.dmzredirect.dest_ip
uci_set firewall.@dmzredirect[0].dest_mac firewall.dmzredirect.dest_mac
uci_set firewall.dmzredirects.enabled
uci_set firewall.dmzredirects.enabled firewall.fwconfig.dmz
uci_set firewall.dmzredirect.dest_mac
uci_set firewall.dmzredirect.dest_ip
uci_section firewall.@rule id=name

copy_file /etc/config/igmpproxy

uci_set intercept.config.enabled

copy_file /etc/config/ipping

#copy_file /etc/config/iqos

copy_file /etc/config/mcastsnooping

uci_set minidlna.config.enabled dlnad.config.enabled
uci_set minidlna.config.friendly_name dlnad.config.friendly_name

uci_set dlnad.config.enabled
uci_set dlnad.config.model_url
uci_set dlnad.config.model_name
uci_set dlnad.config.manufacturer_url
uci_set dlnad.config.friendly_name
uci_set dlnad.config.radioStations_enabled

uci_set dlnad.log.mud_logLevel
uci_set dlnad.log.mvfs_logLevel
uci_set dlnad.log.dlnad_logLevel


#MMPBX config
uci_set mmpbx.global.enabled
uci_set mmpbxrvsipnet.sip_net.cac
uci_set mmpbxrvsipnet.sip_net.primary_proxy
uci_set mmpbxrvsipnet.sip_net.primary_registrar

uci_section mmpbx.@profile 
uci_section mmpbx.@incoming_map id=profile
uci_section mmpbx.@outgoing_map id=device
uci_section mmpbx.@service id=type

uci_section mmpbxbrcmdectdev.@base
uci_section mmpbxbrcmdectdev.@device
uci_section mmpbxrvsipnet.@profile 

copy_file /etc/griffinnvs.bin

copy_file /etc/lasdb.db
inline_sh_cmd lua /usr/bin/convlasdb /etc/lasdb.db

inline_sh_cmd /usr/bin/convmobiledongle %%OLDCONFIG%%

uci_section mobiled.@profile id=id
uci_section mobiled.@sim
uci_section mobiled.@device
inline_sh_cmd lua /usr/lib/parameter_conversion/copy_mobiled_device_defaults.lua

uci_set mobiled.device_defaults.network_selection
uci_set mobiled.device_defaults.mcc
uci_set mobiled.device_defaults.mnc
uci_set mobiled.device_defaults.radio_pref
uci_set mobiled.device_defaults.lte_bands
uci_set mobiled.device_defaults.earfcn



#ENV

uci_section env.custovar
#Move 15.4 values to the new location
uci_set env.var.WS env.custovar.WS
uci_set env.var.wan_vlan_enabled env.custovar.wan_vlan_enabled
uci_set env.var.wan_vlan env.custovar.wan_vlan
uci_set env.var.ISP env.custovar.ISP
uci_set env.var.URL env.custovar.URL 
uci_set env.var.first env.custovar.first
uci_set env.var.setup env.custovar.setup

uci_set env.custovar.WS
uci_set env.custovar.wan_vlan_enabled
uci_set env.custovar.wan_vlan
uci_set env.custovar.ISP
uci_set env.custovar.URL 
uci_set env.custovar.first
uci_set env.custovar.setup

#Flag to show upgraded
inline_sh_cmd uci set env.custovar.upgraded=1
inline_sh_cmd uci commit env

#New cleaner network conversion
uci_section network.@interface
uci_section network.@device
#disabled to move tothe common name from _ext to not
#uci_section network.@switch
uci_section network.@switch_vlan id=vlan
uci_section network.@route
uci_set network.config.wan_mode
uci_set network.config.unnumbered

inline_sh_cmd uci set network.wwan.auto=1

inline_sh_cmd uci commit network

inline_sh_cmd sed -i s/wan_vlan/vlan_wan/g /etc/config/network

inline_sh_cmd /etc/parameter_conversion/scripts/copy_ppp_state.sh %%OLDCONFIG%%

#WAN Sensing
uci_set wansensing.global.enable
uci_set wansensing.global.l2type
uci_set wansensing.global.l3type

uci_set network.wwan.profile

copy_file /etc/config/nslookupdiag

#Parental Page removed
#uci_set parental.general.enable
#uci_set parental.general.ipv6_enable
#uci_set parental.general.exclude

#uci_section parental.@URLfilter 

copy_file /etc/config/portmirror

copy_file /etc/config/power

copy_file /etc/config/pppoerelayd

copy_file /etc/config/printersharing

#copy_file /etc/config/qos

uci_section qos.@reclassify

uci_set samba.@samba[0].name samba.samba.name
uci_set samba.@samba[0].workgroup samba.samba.workgroup
uci_set samba.@samba[0].description samba.samba.description
uci_set samba.@samba[0].enabled samba.samba.enabled

uci_set samba.samba.name
uci_set samba.samba.workgroup
uci_set samba.samba.description
uci_set samba.samba.enabled

uci_set samba.printers.enabled

uci_set system.@system[0].zonename
uci_set system.@system[0].timezone
uci_set system.@system[0].network_timezone
uci_list system.ntp.server
uci_set system.@system[0].log_ip
uci_set system.@system[0].log_type
uci_set system.@system[0].log_file
uci_set system.@system[0].log_size
uci_set system.@system[0].log_port
uci_set system.@system[0].log_prefix
uci_set system.@system[0].log_filter_ip
uci_set system.@system[0].log_filter
uci_set system.@system[0].log_filter_file
uci_set system.config.enable_usb3_support

inline_sh_cmd lua /etc/parameter_conversion/scripts/convtod.lua
uci_section tod.@host

copy_file /etc/config/traceroute
copy_file /etc/config/txmember

#UPnP
uci_set upnpd.config.enable_natpmp
uci_set upnpd.config.enable_upnp
uci_set upnpd.config.secure_mode
 
copy_file /etc/config/user_friendly_name

#WIFI Doctor
copy_file /etc/config/wifidoctor_station_importance
uci_set wifi_doctor_agent.as_config.passwd
uci_set wifi_doctor_agent.config.enabled


#NGWFDD
copy_file /etc/config/ngwfdd

#Wireless
uci_section wireless.@wifi-device
uci_section wireless.@wifi-iface
uci_section wireless.@wifi-ap
uci_section wireless.@wifi-radius-server
uci_section wireless.@wifi-bandsteer

#DSL State
uci_set xdsl.dsl0.enabled

copy_file /etc/config/xtm

#Save if Remote is Active (should this survive?)
#uci_set web.remote.active

#Keep Session settings
uci_section web.remotefixed


#Change to capture the new GUI added users 
uci_list web.default.users
inline_sh_cmd uci del_list web.default.users=usr_engineer
inline_sh_cmd uci add_list web.default.users=usr_engineer

copy_web_users

inline_sh_cmd convcmds copy_shadow_psw engineer



#ISP Files by Reseller
copy_dir /www/docroot/img/custom/
copy_dir /etc/ispconfig/

inline_sh_cmd sed -i s/env.var.WS/env.custovar.WS/g /etc/ispconfig/tch_0000-ispconfig
inline_sh_cmd sed -i s/env.var.wan_vlan_enabled/env.custovar.wan_vlan_enabled/g /etc/ispconfig/tch_0000-ispconfig
inline_sh_cmd sed -i s/env.var.wan_vlan/env.custovar.wan_vlan/g /etc/ispconfig/tch_0000-ispconfig
inline_sh_cmd sed -i s/env.var.ISP/env.custovar.ISP/g /etc/ispconfig/tch_0000-ispconfig
inline_sh_cmd sed -i s/env.var.URL/env.custovar.URL/g /etc/ispconfig/tch_0000-ispconfig
inline_sh_cmd sed -i s/env.var.first/env.custovar.first/g /etc/ispconfig/tch_0000-ispconfig
inline_sh_cmd sed -i s/env.var.setup/env.custovar.setup/g /etc/ispconfig/tch_0000-ispconfig

