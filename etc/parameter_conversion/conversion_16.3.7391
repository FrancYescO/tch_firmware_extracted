debug_on
# NG-79318; NG-72728/NG-71196/NG-81040; NG-85492

copy_file /etc/config/button

copy_file /etc/cwmpd.db
copy_file /etc/config/cwmp_transfer
inline_sh_cmd /usr/lib/cwmpd/transfers/rollback_check.sh %%OLDCONFIG%%
uci_section cwmpd.cwmpd_config
copy_dir /usr/share/transformer
copy_dir /usr/lib/lua

#NG-81040 since by default all TI config is based on th enew naming already, the next block is nit needed anymore
#NG-81040 uci_set ddns.myddns.enabled ddns.myddns_ipv4.enabled
#NG-81040 uci_set ddns.myddns.service_name ddns.myddns_ipv4.service_name
#NG-81040 uci_set ddns.myddns.domain ddns.myddns_ipv4.domain
#NG-81040 uci_set ddns.myddns.username ddns.myddns_ipv4.username
#NG-81040 uci_set ddns.myddns.password ddns.myddns_ipv4.password
#NG-81040 uci_del ddns.myddns

#NG-81040 since this is only a limited amount of parameters, and since Clash is providing the whole set of config, the next block will be repaced by uci section command 
#NG-81040 uci_set ddns.myddns_ipv4.enabled
#NG-81040 uci_set ddns.myddns_ipv4.service_name
#NG-81040 uci_set ddns.myddns_ipv4.domain
#NG-81040 uci_set ddns.myddns_ipv4.username
#NG-81040 uci_set ddns.myddns_ipv4.password

#NG-81040 since Clash is providing the whole configuration possibilities, and also supporting then to configure multiple ddns services,
uci_section ddns.@service
uci_set ddns.myddns_ipv4.lookup_host
inline_sh_cmd lua -e \"uc=require 'uciconv' o=uc.uci('old') n=uc.uci('new') v=o:get('ddns','myddns_ipv4','service_name') if (v == 'No-IP.com' or v == 'NoIP.com') then n:set('ddns','myddns_ipv4','service_name','no-ip.com') end n:commit('ddns')\"

uci_set dhcp.odhcpd.leasefile
uci_set dhcp.odhcpd.leasetrigger

#NG-79318: replacing individual sets by Section dhcp
#NG-79318:uci_set dhcp.lan.interface
#NG-79318:uci_set dhcp.lan.start
#NG-79318:uci_set dhcp.lan.limit
#NG-79318:uci_set dhcp.lan.leasetime
#NG-79318:uci_set dhcp.lan.dhcpv6
#NG-79318:uci_set dhcp.lan.ra_management
#NG-79318:uci_set dhcp.lan.ra_min_interval
#NG-79318uci_set dhcp.lan.ra_max_interval
#NG-79318uci_set dhcp.lan.ra_lifetime
#NG-79318uci_set dhcp.lan.ra_hoplimit
#NG-79318uci_set dhcp.lan.ra_max_mtu
#NG-79318uci_set dhcp.lan.force
#NG-79318uci_set dhcp.lan.ignore

#NG-79318uci_set dhcp.wan.interface
#NG-79318uci_set dhcp.wan.ignore
uci_section dhcp.@dhcp

inline_sh_cmd lua -e \"uc=require 'uciconv' o=uc.uci('old') n=uc.uci('new') v=o:get('dhcp','wan','ignore') if (v == '1') then n:set('dhcp','wan','dhcpv4','disabled') else n:set('dhcp','wan','dhcpv4','server') end n:commit('dhcp')\"
uci_section dhcp.@host id=name
inline_sh_cmd lua -e \"uc=require 'uciconv' o=uc.uci('old') n=uc.uci('new') v=o:get('dhcp','lan','ignore') if (v ~= nil) then if (v == '1') then n:set('dhcp','lan','dhcpv4','disabled') n:set('dhcp','lan','ignore','') else n:set('dhcp','lan','dhcpv4','server') end end n:commit('dhcp')\"
inline_sh_cmd lua -e \"uc=require 'uciconv' o=uc.uci('old') n=uc.uci('new') v=o:get('dhcp','wlnet_b_24','ignore') if (v ~= nil) then if (v == '1') then n:set('dhcp','wlnet_b_24','dhcpv4','disabled') n:set('dhcp','wlnet_b_24','ignore','') else n:set('dhcp','wlnet_b_24','dhcpv4','server') end end n:commit('dhcp')\"
inline_sh_cmd lua -e \"uc=require 'uciconv' o=uc.uci('old') n=uc.uci('new') v=o:get('dhcp','wlnet_b_5','ignore') if (v ~= nil) then if (v == '1') then n:set('dhcp','wlnet_b_5','dhcpv4','disabled') n:set('dhcp','wlnet_b_5','ignore','') else n:set('dhcp','wlnet_b_5','dhcpv4','server') end end n:commit('dhcp')\"


copy_file /etc/config/dscp2pbit

#added for capturing firewall setting
#NG-79932: replaced by section to assure new settings to be taken along copy_file /etc/config/firewall
#NG-86953: Since meanwhile on newer Firmware, and normally all Firmware already based on named from which will be upgraded to this 17.1 Firmware, NG-85492 will be reverted/activated
uci_section firewall.@zone id=name
uci_section firewall.@forwarding id=src
uci_section firewall.@rule id=name
uci_section firewall.@cone id=name
uci_section firewall.@fwconfig
uci_set firewall.dmzredirects.enabled
uci_set firewall.dmzredirect.dest_mac
uci_set firewall.dmzredirect.dest_ip
uci_section firewall.@userredirect
uci_section firewall.@rulesgroup id=name
uci_section firewall.@highrule id=name
uci_section firewall.@defaultrule id=name

#NG-94238 Firewall helper sip name should be unique for migration to work
uci_set firewall.ftphelper.enable
uci_set firewall.irchelper.enable
uci_set firewall.siphelper.enable
uci_set firewall.pptphelper.enable
uci_set firewall.rtspphelper.enable
uci_set firewall.snmphelper.enable
uci_set firewall.tftphelper.enable
uci_set firewall.siploopback.enable
uci_set firewall.amandahelper.enable

uci_section firewall.@userrule id=name
uci_section firewall.@userrule_v6 id=name
uci_section firewall.@fwconfig
uci_section firewall.@zone id=name
#uci_set firewall.defaultoutgoing.target
#uci_set firewall.normalrules.enabled
#uci_set firewall.laxrules.enabled
#uci_set firewall.highrules.enabled
#uci_set firewall.userrules.enabled
#uci_set firewall.userrules_v6.enabled
#uci_set firewall.defaultrules.enabled
#uci_section firewall.@userredirect
#uci_set firewall.userredirects.enabled
#uci_set firewall.@dmzredirect[0].dest_ip firewall.dmzredirect.dest_ip
#uci_set firewall.dmzredirects.enabled
#uci_set firewall.dmzredirect.dest_mac
#uci_set firewall.dmzredirect.dest_ip

#NG-157899
uci_set firewall.dmzredirect.enabled

copy_file /etc/config/igmpproxy

copy_file /etc/config/intercept

copy_file /etc/config/ipping

#NG-100899 "TIM: Do not copy qos configuration file" copy_file /etc/config/iqos

copy_file /etc/config/mcastsnooping



uci_set minidlna.config.enabled dlnad.config.enabled
uci_set minidlna.config.friendly_name dlnad.config.friendly_name

uci_set dlnad.config.enabled
uci_set dlnad.config.model_url
uci_set dlnad.config.model_name
uci_set dlnad.config.manufacturer_url
uci_set dlnad.config.friendly_name
uci_set dlnad.config.radioStations_enabled


#NG-79932: event description shall not be set anymore fromTI_006, also reducing the sections to the once propably only modified onwards copy_file /etc/config/mmpbx
uci_section mmpbx.@mmpbx
uci_section mmpbx.@syslog
uci_section mmpbx.@incoming_map id=profile
#NG-106028: modified to device to assure uniqueness for outgoing map
uci_section mmpbx.@outgoing_map id=device
 
#NG-79932/NG-.... commented, since moved to named parameters in TI_006 :uci_section mmpbx.@service id=type
uci_section mmpbx.@scc
uci_section mmpbx.@dial_plan
uci_section mmpbx.@dial_plan_entry id=pattern
uci_section mmpbx.@media_filter
uci_section mmpbx.@codec_filter id=name
#uci_section mmpbx.@tone
uci_section mmpbx.@audionotification.-callhold.event_description
uci_section mmpbx.@areacode_translation id=prefix

#NG-97421 Signalling tones behavior
inline_sh_cmd lua -e \"uc=require 'uciconv' n=uc.uci('new') n:set('mmpbx','global','dial_timeout','20') n:commit('mmpbx')\"
inline_sh_cmd lua -e \"uc=require 'uciconv' n=uc.uci('new') n:set('mmpbx','congestion','loop_iterations','100') n:commit('mmpbx')\"

#NG-141427 Inter-digit timer not correct should be 3sec iso 5sec
inline_sh_cmd lua -e \"uc=require 'uciconv' o=uc.uci('old') n=uc.uci('new') v=o:get('mmpbx','dial_plan_generic','open_inter_digit_timer') if (v == '5000') then n:set('mmpbx','dial_plan_generic','open_inter_digit_timer','3000') end n:commit('mmpbx')\"
inline_sh_cmd lua -e \"uc=require 'uciconv' o=uc.uci('old') n=uc.uci('new') v=o:get('mmpbx','dial_plan_generic','closed_inter_digit_timer') if (v == '5000') then n:set('mmpbx','dial_plan_generic','closed_inter_digit_timer','3000') end n:commit('mmpbx')\"

copy_file /etc/config/mmpbxbrcmdectdev

#NG-79932: changed to sections, to assure also new addded parameters on newer Release are taken along copy_file /etc/config/mmpbxbrcmfxsdev
uci_section mmpbxbrcmfxsdev.global
uci_section mmpbxbrcmfxsdev.@device id=user_friendly_name
uci_section mmpbxbrcmfxsdev.@keypad


copy_file /etc/config/mmpbxinternalnet

#NG-72983 and NG-73559
#copy_file /etc/config/mmpbxrvsipnet
uci_section mmpbxrvsipnet.@profile

uci_section mmpbxrvsipnet.@network.-user_agent
inline_sh_cmd lua -e \"uc=require 'uciconv' n=uc.uci('new') n:set('mmpbxrvsipnet','sip_net','provisional_timer','1200') n:commit('mmpbxrvsipnet')\"
#NG-96303 replacing NG-90560 since proper SW fix is now in place
#temporary disabled as per Antonio's decision
inline_sh_cmd uci set mmpbxrvsipnet.sip_net.early_media_detection='1'

#NG-108086 Improper Caller ID info shown on DECT devices
inline_sh_cmd lua -e \"uc=require 'uciconv' o=uc.uci('old') n=uc.uci('new') v=o:get('mmpbxbrcmfxsdev','fxs_dev_0','cid_display_calling_party_name_enabled') if (v == '1') then n:set('mmpbxbrcmfxsdev','fxs_dev_0','cid_display_calling_party_name_enabled','0') end n:commit('mmpbxbrcmfxsdev')\"
inline_sh_cmd lua -e \"uc=require 'uciconv' o=uc.uci('old') n=uc.uci('new') v=o:get('mmpbxbrcmfxsdev','fxs_dev_1','cid_display_calling_party_name_enabled') if (v == '1') then n:set('mmpbxbrcmfxsdev','fxs_dev_0','cid_display_calling_party_name_enabled','0') end n:commit('mmpbxbrcmfxsdev')\"
inline_sh_cmd lua -e \"uc=require 'uciconv' o=uc.uci('old') n=uc.uci('new') v=o:get('mmpbxbrcmcountry','fsk','remove_reason_noname') if (v == '0') then n:set('mmpbxbrcmcountry','fsk','remove_reason_noname','1') end n:commit('mmpbxbrcmcountry')\"

#uci_set mmpbxrvsipnet.sip_net.local_port
#uci_set mmpbxrvsipnet.sip_net.domain_name
#uci_set mmpbxrvsipnet.sip_net.primary_proxy
#uci_set mmpbxrvsipnet.sip_net.primary_proxy_port
#uci_set mmpbxrvsipnet.sip_net.primary_registrar
#uci_set mmpbxrvsipnet.sip_net.primary_registrar_port
#uci_set mmpbxrvsipnet.sip_net.secondary_proxy_port


copy_file /etc/config/mmpbxbrcmfxonet

copy_file /etc/griffinnvs.bin

copy_file /etc/lasdb.db
inline_sh_cmd lua /usr/bin/convlasdb /etc/lasdb.db

inline_sh_cmd /usr/bin/convmobiledongle %%OLDCONFIG%%

uci_section mobiled.@profile id=id
#NG-81865: modifed next two instances by adding id
uci_section mobiled.@sim id=iccid
uci_section mobiled.@device id=imei

uci_set network.ppp.password
uci_set network.ppp.username
uci_set network.ppp.graceful_restart

# in the course of NG-72728/NG-71196 have dedicated values been removed 
# and exchanged by sections, since also changes on device and on additional lan interfaces 
# and cascaded Interfaces need to be taken into account
#NG-72728/NG-71196 uci_set network.lan.netmask
#NG-72728/NG-71196 uci_set network.lan.ipaddr
#NG-72728/NG-71196 uci_set network.lan.ipv6
#NG-72728/NG-71196 uci_set network.wan.username
#NG-72728/NG-71196 uci_set network.wan.password
#NG-72728/NG-71196 uci_set network.wan.graceful_restart
#NG-72728/NG-71196 uci_set network.wan.ifname
#NG-72728/NG-71196 uci_set network.wan.proto

#Change to capture the vlan_id
#NG-72728/NG-71196 uci_set network.waneth4.vid
#NG-72728/NG-71196 uci_set network.wanptm0.vid

#change to capture wan ipv6 address NG-71301
#NG-72728/NG-71196 uci_set network.wan.ipv6
uci_section network.@interface
uci_section network.@device

#NG-101421 remove static DNS
inline_sh_cmd uci delete network.loopback.dns
inline_sh_cmd uci delete network.loopback.dns_metric

inline_sh_cmd /etc/parameter_conversion/scripts/copy_ppp_state.sh %%OLDCONFIG%%

uci_set network.wwan.profile

copy_file /etc/config/nslookupdiag

copy_file /etc/config/parental

copy_file /etc/config/portmirror

copy_file /etc/config/power

copy_file /etc/config/pppoerelayd

copy_file /etc/config/printersharing

#NG-100899 "TIM: Do not copy qos configuration file"  copy_file /etc/config/qos

uci_set samba.@samba[0].name
uci_set samba.@samba[0].workgroup
uci_set samba.@samba[0].description
#NG-94245 - Migrate of samba enable state
#NG-100874 TI Migration: (VBNT-S:Follow up of NG-96613) Disabled Samba configuration in GUI gets enabled after migration
inline_sh_cmd lua -e \"uc=require 'uciconv' o=uc.uci('old') n=uc.uci('new') v=o:get('samba','samba','enabled') w=o:get('samba','samba','filesharing') if (w == nil) then if (v == '0') then n:set('samba','samba','enabled','1') n:set('samba','samba','filesharing','0') else n:set('samba','samba','enabled','1') n:set('samba','samba','filesharing','1') end elseif (w == '1') then n:set('samba','samba','filesharing','1') else n:set('samba','samba','filesharing','0') end n:commit('samba')\"

#uci_set samba.@samba[0].enabled

uci_set system.@system[0].zonename
uci_set system.@system[0].timezone
uci_set system.@system[0].network_timezone
uci_list system.ntp.server
uci_set system.@system[0].log_ip
uci_set system.@system[0].log_type
uci_set system.@system[0].log_file
uci_set system.@system[0].log_size
uci_set system.@system[0].log_port
uci_set system.@system[0].log_prefix
uci_set system.@system[0].log_filter_ip
uci_set system.@system[0].log_filter
uci_set system.@system[0].log_filter_file

copy_file /etc/config/tod

copy_file /etc/config/traceroute

copy_file /etc/config/txmember

uci_set upnpd.config.enable_natpmp
uci_set upnpd.config.enable_upnp
uci_set upnpd.config.secure_mode
 
copy_file /etc/config/user_friendly_name







copy_file /etc/config/wifidoctor_station_importance

uci_section wireless.@wifi-device.-acs_rescan_period,acs_channel_monitor_period
uci_section wireless.@wifi-iface
uci_section wireless.@wifi-radius-server

#NG-178878 [TIM Migration] - Wireless ACL modes are migrated (r.earlier than 17.3.c)
uci_section wireless.@wifi-ap.-acl_mode
#NG-112721 TIM: wmm power save active on 5g guest ssid
inline_sh_cmd lua -e \"uc=require 'uciconv' o=uc.uci('old') n=uc.uci('new') v=o:get('wireless','wl1_1','uapsd') if (v == 'nil') then n:set('wireless','wl1_1','uapsd','0') end n:commit('wireless')\"

#as per NG-82117, removed NG-82113 implemented as Workaround to fully support NG-71142, from 16.3.7391 the default settings of NG-71142 are already in, so only this removal is needed
#inline_sh_cmd rm /tmp/hostapd.env

#NG-96591
inline_sh_cmd uci set wireless.radio_2G.sgi='1'

#NG-88414
inline_sh_cmd uci set wireless.radio_2G.tx_power_adjust='+2'
inline_sh_cmd uci set wireless.radio_2G.tx_power_overrule_reg='1'

#NG-106403 MU-MIMO needs to be disabled
inline_sh_cmd uci set wireless.radio_5G.mumimo='0'

#NG-97056
inline_sh_cmd uci set wireless.ap0.supported_security_modes='none wep wpa2-psk wpa-wpa2-psk
inline_sh_cmd uci set wireless.ap1.supported_security_modes='none wpa2-psk wpa-wpa2-psk
inline_sh_cmd uci set wireless.ap2.supported_security_modes='none wep wpa2-psk wpa-wpa2-psk'
inline_sh_cmd uci set wireless.ap3.supported_security_modes='none wpa2-psk wpa-wpa2-psk'


uci_set xdsl.dsl0.enabled

copy_file /etc/config/xtm

copy_file /etc/config/gpon
copy_file /etc/config/gponl3

#Change to capture the new GUI added users 
uci_list web.default.users
#inline_sh_cmd uci del_list web.default.users=usr_engineer
#inline_sh_cmd uci add_list web.default.users=usr_engineer

copy_web_users



# wansensing
# the build shall have the correct config.
copy_file /etc/config/wansensing

#change to address NG-78471: Inform with Provisioning Code null after FW upgrade
uci_set env.var.provisioning_code
#in conjunction with NG-79932 added to assure, that the env var needed for ppp are copied, based on the running config to assure proper GUI functionality
uci_set env.var.ppp_realm_ipv6
uci_set env.var.ppp_realm_ipv4
