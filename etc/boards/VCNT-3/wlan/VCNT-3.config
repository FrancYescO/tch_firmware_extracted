#!/bin/sh /etc/rc.common

. $IPKG_INSTROOT/lib/functions/functions-tch.sh

setRadioMacAddress()
{
    WL0_MAC=`uci_get env.rip.wifi_mac`
    L_WL_MAC=`uci_get env.var.local_wifi_mac`
    WL1_MAC="${L_WL_MAC:0:15}$(printf "%02X" $(((0x${L_WL_MAC:15:16} + 0x08) % 256)))"
    echo "nvram set MAC WL0:$WL0_MAC"
    nvram set 2:macaddr="$WL0_MAC"
    echo "nvram set MAC WL1:$WL1_MAC"
    nvram set 1:macaddr="$WL1_MAC"
}

applyTrimming()
{
	if [ ! -f "/etc/wlan/apply_pa_trim_2G.sh" ] || [ ! -f "/etc/wlan/apply_pa_trim_5G.sh" ]; then
		if [ -f "/etc/wlan/parse_pa_trimming.sh" ]; then
			echo "No patch scripts available. Parsing"
			sh /etc/wlan/parse_pa_trimming.sh
		fi
	fi
	if [ -f "/etc/wlan/apply_pa_trim_2G.sh" ] && [ -f "/etc/wlan/apply_pa_trim_5G.sh" ]; then
		echo "Patching PA parameters"
		sh /etc/wlan/apply_pa_trim_2G.sh
		sh /etc/wlan/apply_pa_trim_5G.sh
	else
		echo "No PA patching available for this platform"
	fi
}

getNicCount()
{
    local unit=0
    echo $unit
}

setRadioKthreadAffinity()
{
    setcpumask wfd0-thrd 1
    setcpumask wfd1-thrd 2
}

setRadioInterruptAffinity()
{
    setRadioIntAffinity 0 1
    setRadioIntAffinity 1 2
}

setRadioKthreadPriority()
{
    setrtprio wfd0-thrd 5
    setrtprio wfd1-thrd 5
}
