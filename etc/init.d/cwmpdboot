#!/bin/sh /etc/rc.common

USE_PROCD=1
CWMPD_PID_FILE=/var/run/cwmpd.pid
CWMPEVENTS_PID_FILE=/var/run/cwmpevents.pid

boot() {
  logger -t cwmpd "Starting cwmpd on boot"

  if [ -f /usr/bin/cwmpd-boot-delay ]; then
     logger -t cwmpd "Calling cwmpd-boot-delay script."
     source /usr/bin/cwmpd-boot-delay
  fi

  procd_open_service "cwmpd"

  procd_open_instance
  procd_set_param command /usr/bin/cwmpd
  procd_set_param pidfile "${CWMPD_PID_FILE}"
  procd_set_param respawn ${respawn_threshold:-3600} ${respawn_timeout:-5} ${respawn_retry:-5}
  procd_close_instance

  procd_open_instance
  procd_set_param command /usr/bin/cwmpevents
  procd_set_param pidfile "${CWMPEVENTS_PID_FILE}"
  procd_set_param respawn ${respawn_threshold:-3600} ${respawn_timeout:-5} ${respawn_retry:-5}
  procd_close_instance
  procd_close_service
  service_started
}
